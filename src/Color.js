/*
Auto-generated by: https://github.com/pmndrs/gltfjsx
*/

import React, { useEffect, useRef, useState } from 'react'
import { useGLTF } from '@react-three/drei/useGLTF'
import { useWheel } from './store'
import { useSpring, a } from '@react-spring/three'

export default function Model(props) {
  const group = useRef()
  const { nodes, materials } = useGLTF('/Color.gltf')
  const palette = useWheel((s) => s.palette)
  const wheelOpen = useWheel((s) => s.wheelOpen)
  const [localOpen, setLocalOpen] = useState(wheelOpen)

  const springRef = useRef()
  const { pos } = useSpring({
    ref: springRef,
    pos: 0
  })

  useEffect(() => {
    if (group.current) {
      group.current.children.forEach(({material}) => material.color.set(palette[Math.round(4 * Math.random())]))
    }
  }, [palette])

  useEffect(() => {
      springRef.current.start({
        pos: wheelOpen ? -7 : 0,
        delay: wheelOpen ? 0 : 1500,
        onRest: () => setLocalOpen(true)
      })
  }, [localOpen, setLocalOpen, wheelOpen])

  return (
    <group {...props} dispose={null}>
      <group ref={group} position={[-0.54, 1.08, 1.69]}>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder001.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder002.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder003.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder004.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder005.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder006.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder007.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder008.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder009.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder010.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder011.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder012.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder013.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder014.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder015.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder016.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder017.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder018.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder019.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder020.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder021.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder022.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder023.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder024.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder025.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder026.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder027.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder028.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder029.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder030.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder031.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder032.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder033.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder034.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
        <mesh castShadow receiveShadow geometry={nodes.Cylinder035.geometry} rotation={[0, 0, -Math.PI / 2]} >
          <meshPhysicalMaterial metalness={0.8} roughness={1}/>
        </mesh>
      </group>
      <mesh receiveShadow castShadow material={materials.black} geometry={nodes.Cube.geometry} position={[0, 1, 0]}>
        <a.mesh
          position-z={pos}
          receiveShadow
          castShadow
          renderOrder={1}
          geometry={nodes.Slice.geometry}
        >
            <meshPhysicalMaterial
              transmission={1}
              metalness={0.3}
              clearcoat={1}
              roughness={1}
              transparent
              color="black"
            />
        </a.mesh>
      </mesh>
    </group>
  )
}

useGLTF.preload('/Color.gltf')
